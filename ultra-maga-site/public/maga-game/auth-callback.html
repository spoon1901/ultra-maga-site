<!DOCTYPE html>
<html>
<head><title>Twitter Auth</title></head>
<body>
<script>
const params = new URLSearchParams(window.location.search);
const code = params.get('code');
const state = params.get('state');

const savedState = localStorage.getItem('twitter_state');
const codeVerifier = localStorage.getItem('twitter_code_verifier');

if (state !== savedState) {
  alert("State mismatch.");
  throw new Error("State mismatch.");
}

fetch('https://api.twitter.com/2/oauth2/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
    'Authorization': 'Basic ' + btoa('YOUR_CLIENT_ID:YOUR_CLIENT_SECRET')
  },
  body: new URLSearchParams({
    grant_type: 'authorization_code',
    code: code,
    redirect_uri: 'https://ultramagaxrpl.com/maga-game/auth-callback.html',
    code_verifier: codeVerifier
  })
})
.then(res => res.json())
.then(token => {
  return fetch('https://api.twitter.com/2/users/me', {
    headers: {
      Authorization: `Bearer ${token.access_token}`
    }
  });
})
.then(res => res.json())
.then(data => {
  const twitterId = data.data.id;
  localStorage.setItem('twitterId', twitterId);
  window.location.href = '/maga-game/';
})
.catch(err => {
  console.error(err);
  alert('Twitter login failed.');
});
</script>
</body>
</html>
