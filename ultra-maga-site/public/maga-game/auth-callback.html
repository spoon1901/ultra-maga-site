<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Twitter Auth Callback</title>
</head>
<body style="background: #000; color: white;">
  <h2>Authenticating...</h2>

<script>
  const params = new URLSearchParams(window.location.search);
  const code = params.get('code');
  const codeVerifier = sessionStorage.getItem('code_verifier');

  if (code && codeVerifier) {
    fetch(`https://YOUR-BACKEND-URL.com/auth/twitter?code=${code}&code_verifier=${codeVerifier}`)
      .then(res => res.json())
      .then(data => {
        if (data.user) {
          const userId = data.user.id;
          const username = data.user.username;
          const profileImage = data.user.profile_image_url || '';

          localStorage.setItem('twitter_user_id', userId);
          localStorage.setItem('twitter_username', username);
          localStorage.setItem('twitter_profile', profileImage);

          window.location.href = "/maga-game/"; // back to game
        } else {
          alert('Twitter login failed.');
          window.location.href = "/maga-game/";
        }
      })
      .catch(() => {
        alert('Login error.');
        window.location.href = "/maga-game/";
      });
  } else {
    alert('Missing login info.');
    window.location.href = "/maga-game/";
  }
</script>

</body>
</html>
